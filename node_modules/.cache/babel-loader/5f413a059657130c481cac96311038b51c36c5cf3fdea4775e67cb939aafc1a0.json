{"ast":null,"code":"import React,{createContext,useContext,useReducer}from'react';import{useAuth}from'./AuthContext';import{v4 as uuidv4}from'uuid';import{jsx as _jsx}from\"react/jsx-runtime\";const initialState={currentSale:null,loading:false,error:null};function saleReducer(state,action){switch(action.type){case'CREATE_SALE':{const{customerId,customer}=action.payload;const newSale={id:uuidv4(),customerId,customer,cashierId:'',// Will be set from auth context\ncashier:{},// Will be set from auth context\nitems:[],status:'draft',subtotal:0,tax:0,discount:0,total:0,paymentMethod:'cash',createdAt:new Date(),updatedAt:new Date()};return{...state,currentSale:newSale,error:null};}case'ADD_ITEM':{if(!state.currentSale)return state;const{product,quantity,discount=0}=action.payload;const existingItemIndex=state.currentSale.items.findIndex(item=>item.productId===product.id);let updatedItems;if(existingItemIndex>=0){// Update existing item quantity\nupdatedItems=state.currentSale.items.map((item,index)=>{if(index===existingItemIndex){const newQuantity=item.quantity+quantity;return{...item,quantity:newQuantity,totalPrice:(item.unitPrice-(item.discount||0))*newQuantity};}return item;});}else{// Add new item\nconst newItem={id:uuidv4(),productId:product.id,product,quantity,unitPrice:product.price,discount,totalPrice:(product.price-discount)*quantity};updatedItems=[...state.currentSale.items,newItem];}const subtotal=updatedItems.reduce((sum,item)=>sum+item.totalPrice,0);const tax=subtotal*0.18;// 18% GST\nconst total=subtotal+tax;return{...state,currentSale:{...state.currentSale,items:updatedItems,subtotal,tax,total,updatedAt:new Date()}};}case'REMOVE_ITEM':{if(!state.currentSale)return state;const updatedItems=state.currentSale.items.filter(item=>item.id!==action.payload);const subtotal=updatedItems.reduce((sum,item)=>sum+item.totalPrice,0);const tax=subtotal*0.18;const total=subtotal+tax;return{...state,currentSale:{...state.currentSale,items:updatedItems,subtotal,tax,total,updatedAt:new Date()}};}case'UPDATE_QUANTITY':{if(!state.currentSale)return state;const{saleItemId,quantity}=action.payload;if(quantity<=0){// Remove item if quantity is 0 or negative\nreturn saleReducer(state,{type:'REMOVE_ITEM',payload:saleItemId});}const updatedItems=state.currentSale.items.map(item=>{if(item.id===saleItemId){return{...item,quantity,totalPrice:(item.unitPrice-(item.discount||0))*quantity};}return item;});const subtotal=updatedItems.reduce((sum,item)=>sum+item.totalPrice,0);const tax=subtotal*0.18;const total=subtotal+tax;return{...state,currentSale:{...state.currentSale,items:updatedItems,subtotal,tax,total,updatedAt:new Date()}};}case'UPDATE_DISCOUNT':{if(!state.currentSale)return state;const{saleItemId,discount}=action.payload;const updatedItems=state.currentSale.items.map(item=>{if(item.id===saleItemId){return{...item,discount,totalPrice:(item.unitPrice-discount)*item.quantity};}return item;});const subtotal=updatedItems.reduce((sum,item)=>sum+item.totalPrice,0);const tax=subtotal*0.18;const total=subtotal+tax;return{...state,currentSale:{...state.currentSale,items:updatedItems,subtotal,tax,total,updatedAt:new Date()}};}case'COMPLETE_SALE_START':return{...state,loading:true,error:null};case'COMPLETE_SALE_SUCCESS':return{...state,currentSale:null,loading:false,error:null};case'COMPLETE_SALE_FAILURE':return{...state,loading:false,error:action.payload};case'CANCEL_SALE':return{...state,currentSale:null,error:null};case'CLEAR_ERROR':return{...state,error:null};default:return state;}}const SaleContext=/*#__PURE__*/createContext(undefined);export function SaleProvider(_ref){let{children}=_ref;const[state,dispatch]=useReducer(saleReducer,initialState);const{user}=useAuth();const createSale=customerId=>{const customer=customerId?mockCustomers.find(c=>c.id===customerId):undefined;dispatch({type:'CREATE_SALE',payload:{customerId,customer}});};const addItemToSale=(product,quantity,discount)=>{if(!product.isAvailable){dispatch({type:'COMPLETE_SALE_FAILURE',payload:'Product is not available'});return;}if(product.stockQuantity<quantity){dispatch({type:'COMPLETE_SALE_FAILURE',payload:'Insufficient stock'});return;}dispatch({type:'ADD_ITEM',payload:{product,quantity,discount}});};const removeItemFromSale=saleItemId=>{dispatch({type:'REMOVE_ITEM',payload:saleItemId});};const updateItemQuantity=(saleItemId,quantity)=>{dispatch({type:'UPDATE_QUANTITY',payload:{saleItemId,quantity}});};const updateItemDiscount=(saleItemId,discount)=>{dispatch({type:'UPDATE_DISCOUNT',payload:{saleItemId,discount}});};const completeSale=async paymentMethod=>{if(!state.currentSale||!user){dispatch({type:'COMPLETE_SALE_FAILURE',payload:'No active sale or user'});return;}if(state.currentSale.items.length===0){dispatch({type:'COMPLETE_SALE_FAILURE',payload:'Cannot complete sale with no items'});return;}dispatch({type:'COMPLETE_SALE_START'});try{// Simulate API call\nawait new Promise(resolve=>setTimeout(resolve,1000));const completedSale={...state.currentSale,cashierId:user.id,cashier:user,status:'completed',paymentMethod,completedAt:new Date(),updatedAt:new Date()};// Store in localStorage for offline support\nconst existingSales=JSON.parse(localStorage.getItem('sales')||'[]');existingSales.push(completedSale);localStorage.setItem('sales',JSON.stringify(existingSales));// Update product stock\nstate.currentSale.items.forEach(item=>{const product=item.product;product.stockQuantity-=item.quantity;// Update product in localStorage or send to API\n});dispatch({type:'COMPLETE_SALE_SUCCESS'});}catch(error){dispatch({type:'COMPLETE_SALE_FAILURE',payload:'Failed to complete sale'});}};const cancelSale=()=>{dispatch({type:'CANCEL_SALE'});};const calculateTotal=()=>{var _state$currentSale;return((_state$currentSale=state.currentSale)===null||_state$currentSale===void 0?void 0:_state$currentSale.total)||0;};const scanBarcode=async barcode=>{try{// Simulate barcode scanning - in real app, this would call an API\nawait new Promise(resolve=>setTimeout(resolve,500));const product=mockProducts.find(p=>p.barcode===barcode);return product||null;}catch(error){console.error('Barcode scan failed:',error);return null;}};const value={currentSale:state.currentSale,createSale,addItemToSale,removeItemFromSale,updateItemQuantity,updateItemDiscount,completeSale,cancelSale,calculateTotal,scanBarcode};return/*#__PURE__*/_jsx(SaleContext.Provider,{value:value,children:children});}export function useSale(){const context=useContext(SaleContext);if(context===undefined){throw new Error('useSale must be used within a SaleProvider');}return context;}export{SaleContext};// Mock data for development\nconst mockProducts=[{id:'1',name:'iPhone 15 Pro',description:'Latest iPhone with A17 Pro chip',price:999,category:'smartphones',brand:'Apple',model:'iPhone 15 Pro',barcode:'1234567890123',sku:'APL-IP15P-128',isAvailable:true,stockQuantity:25,minStockLevel:5,warranty:12,specifications:{'Storage':'128GB','Color':'Natural Titanium','Display':'6.1-inch Super Retina XDR'},createdAt:new Date(),updatedAt:new Date()},{id:'2',name:'Samsung Galaxy S24',description:'Flagship Android smartphone',price:799,category:'smartphones',brand:'Samsung',model:'Galaxy S24',barcode:'2345678901234',sku:'SAM-GS24-256',isAvailable:true,stockQuantity:15,minStockLevel:3,warranty:12,specifications:{'Storage':'256GB','Color':'Phantom Black','Display':'6.2-inch Dynamic AMOLED'},createdAt:new Date(),updatedAt:new Date()}];const mockCustomers=[{id:'1',name:'John Doe',phone:'+1234567890',email:'john@example.com',address:'123 Main St, City',createdAt:new Date(),totalPurchases:2500,lastVisit:new Date()},{id:'2',name:'Jane Smith',phone:'+1987654321',email:'jane@example.com',createdAt:new Date(),totalPurchases:1200,lastVisit:new Date(Date.now()-7*24*60*60*1000)// 7 days ago\n}];","map":{"version":3,"names":["React","createContext","useContext","useReducer","useAuth","v4","uuidv4","jsx","_jsx","initialState","currentSale","loading","error","saleReducer","state","action","type","customerId","customer","payload","newSale","id","cashierId","cashier","items","status","subtotal","tax","discount","total","paymentMethod","createdAt","Date","updatedAt","product","quantity","existingItemIndex","findIndex","item","productId","updatedItems","map","index","newQuantity","totalPrice","unitPrice","newItem","price","reduce","sum","filter","saleItemId","SaleContext","undefined","SaleProvider","_ref","children","dispatch","user","createSale","mockCustomers","find","c","addItemToSale","isAvailable","stockQuantity","removeItemFromSale","updateItemQuantity","updateItemDiscount","completeSale","length","Promise","resolve","setTimeout","completedSale","completedAt","existingSales","JSON","parse","localStorage","getItem","push","setItem","stringify","forEach","cancelSale","calculateTotal","_state$currentSale","scanBarcode","barcode","mockProducts","p","console","value","Provider","useSale","context","Error","name","description","category","brand","model","sku","minStockLevel","warranty","specifications","phone","email","address","totalPurchases","lastVisit","now"],"sources":["D:/restaurantPOS/src/contexts/SaleContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useReducer, ReactNode } from 'react';\nimport { Sale, SaleItem, Product, Customer, SaleContextType } from '../types';\nimport { useAuth } from './AuthContext';\nimport { v4 as uuidv4 } from 'uuid';\n\ninterface SaleState {\n  currentSale: Sale | null;\n  loading: boolean;\n  error: string | null;\n}\n\ntype SaleAction =\n  | { type: 'CREATE_SALE'; payload: { customerId?: string; customer?: Customer } }\n  | { type: 'ADD_ITEM'; payload: { product: Product; quantity: number; discount?: number } }\n  | { type: 'REMOVE_ITEM'; payload: string }\n  | { type: 'UPDATE_QUANTITY'; payload: { saleItemId: string; quantity: number } }\n  | { type: 'UPDATE_DISCOUNT'; payload: { saleItemId: string; discount: number } }\n  | { type: 'COMPLETE_SALE_START' }\n  | { type: 'COMPLETE_SALE_SUCCESS' }\n  | { type: 'COMPLETE_SALE_FAILURE'; payload: string }\n  | { type: 'CANCEL_SALE' }\n  | { type: 'CLEAR_ERROR' };\n\nconst initialState: SaleState = {\n  currentSale: null,\n  loading: false,\n  error: null,\n};\n\nfunction saleReducer(state: SaleState, action: SaleAction): SaleState {\n  switch (action.type) {\n    case 'CREATE_SALE': {\n      const { customerId, customer } = action.payload;\n      const newSale: Sale = {\n        id: uuidv4(),\n        customerId,\n        customer,\n        cashierId: '', // Will be set from auth context\n        cashier: {} as any, // Will be set from auth context\n        items: [],\n        status: 'draft',\n        subtotal: 0,\n        tax: 0,\n        discount: 0,\n        total: 0,\n        paymentMethod: 'cash',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n      return {\n        ...state,\n        currentSale: newSale,\n        error: null,\n      };\n    }\n\n    case 'ADD_ITEM': {\n      if (!state.currentSale) return state;\n\n      const { product, quantity, discount = 0 } = action.payload;\n      const existingItemIndex = state.currentSale.items.findIndex(\n        item => item.productId === product.id\n      );\n\n      let updatedItems: SaleItem[];\n\n      if (existingItemIndex >= 0) {\n        // Update existing item quantity\n        updatedItems = state.currentSale.items.map((item, index) => {\n          if (index === existingItemIndex) {\n            const newQuantity = item.quantity + quantity;\n            return {\n              ...item,\n              quantity: newQuantity,\n              totalPrice: (item.unitPrice - (item.discount || 0)) * newQuantity,\n            };\n          }\n          return item;\n        });\n      } else {\n        // Add new item\n        const newItem: SaleItem = {\n          id: uuidv4(),\n          productId: product.id,\n          product,\n          quantity,\n          unitPrice: product.price,\n          discount,\n          totalPrice: (product.price - discount) * quantity,\n        };\n        updatedItems = [...state.currentSale.items, newItem];\n      }\n\n      const subtotal = updatedItems.reduce((sum, item) => sum + item.totalPrice, 0);\n      const tax = subtotal * 0.18; // 18% GST\n      const total = subtotal + tax;\n\n      return {\n        ...state,\n        currentSale: {\n          ...state.currentSale,\n          items: updatedItems,\n          subtotal,\n          tax,\n          total,\n          updatedAt: new Date(),\n        },\n      };\n    }\n\n    case 'REMOVE_ITEM': {\n      if (!state.currentSale) return state;\n\n      const updatedItems = state.currentSale.items.filter(\n        item => item.id !== action.payload\n      );\n\n      const subtotal = updatedItems.reduce((sum, item) => sum + item.totalPrice, 0);\n      const tax = subtotal * 0.18;\n      const total = subtotal + tax;\n\n      return {\n        ...state,\n        currentSale: {\n          ...state.currentSale,\n          items: updatedItems,\n          subtotal,\n          tax,\n          total,\n          updatedAt: new Date(),\n        },\n      };\n    }\n\n    case 'UPDATE_QUANTITY': {\n      if (!state.currentSale) return state;\n\n      const { saleItemId, quantity } = action.payload;\n      \n      if (quantity <= 0) {\n        // Remove item if quantity is 0 or negative\n        return saleReducer(state, { type: 'REMOVE_ITEM', payload: saleItemId });\n      }\n\n      const updatedItems = state.currentSale.items.map(item => {\n        if (item.id === saleItemId) {\n          return {\n            ...item,\n            quantity,\n            totalPrice: (item.unitPrice - (item.discount || 0)) * quantity,\n          };\n        }\n        return item;\n      });\n\n      const subtotal = updatedItems.reduce((sum, item) => sum + item.totalPrice, 0);\n      const tax = subtotal * 0.18;\n      const total = subtotal + tax;\n\n      return {\n        ...state,\n        currentSale: {\n          ...state.currentSale,\n          items: updatedItems,\n          subtotal,\n          tax,\n          total,\n          updatedAt: new Date(),\n        },\n      };\n    }\n\n    case 'UPDATE_DISCOUNT': {\n      if (!state.currentSale) return state;\n\n      const { saleItemId, discount } = action.payload;\n      const updatedItems = state.currentSale.items.map(item => {\n        if (item.id === saleItemId) {\n          return {\n            ...item,\n            discount,\n            totalPrice: (item.unitPrice - discount) * item.quantity,\n          };\n        }\n        return item;\n      });\n\n      const subtotal = updatedItems.reduce((sum, item) => sum + item.totalPrice, 0);\n      const tax = subtotal * 0.18;\n      const total = subtotal + tax;\n\n      return {\n        ...state,\n        currentSale: {\n          ...state.currentSale,\n          items: updatedItems,\n          subtotal,\n          tax,\n          total,\n          updatedAt: new Date(),\n        },\n      };\n    }\n\n    case 'COMPLETE_SALE_START':\n      return {\n        ...state,\n        loading: true,\n        error: null,\n      };\n\n    case 'COMPLETE_SALE_SUCCESS':\n      return {\n        ...state,\n        currentSale: null,\n        loading: false,\n        error: null,\n      };\n\n    case 'COMPLETE_SALE_FAILURE':\n      return {\n        ...state,\n        loading: false,\n        error: action.payload,\n      };\n\n    case 'CANCEL_SALE':\n      return {\n        ...state,\n        currentSale: null,\n        error: null,\n      };\n\n    case 'CLEAR_ERROR':\n      return {\n        ...state,\n        error: null,\n      };\n\n    default:\n      return state;\n  }\n}\n\nconst SaleContext = createContext<SaleContextType | undefined>(undefined);\n\nexport function SaleProvider({ children }: { children: ReactNode }) {\n  const [state, dispatch] = useReducer(saleReducer, initialState);\n  const { user } = useAuth();\n\n  const createSale = (customerId?: string) => {\n    const customer = customerId ? mockCustomers.find(c => c.id === customerId) : undefined;\n    dispatch({ type: 'CREATE_SALE', payload: { customerId, customer } });\n  };\n\n  const addItemToSale = (product: Product, quantity: number, discount?: number) => {\n    if (!product.isAvailable) {\n      dispatch({ type: 'COMPLETE_SALE_FAILURE', payload: 'Product is not available' });\n      return;\n    }\n    \n    if (product.stockQuantity < quantity) {\n      dispatch({ type: 'COMPLETE_SALE_FAILURE', payload: 'Insufficient stock' });\n      return;\n    }\n\n    dispatch({ type: 'ADD_ITEM', payload: { product, quantity, discount } });\n  };\n\n  const removeItemFromSale = (saleItemId: string) => {\n    dispatch({ type: 'REMOVE_ITEM', payload: saleItemId });\n  };\n\n  const updateItemQuantity = (saleItemId: string, quantity: number) => {\n    dispatch({ type: 'UPDATE_QUANTITY', payload: { saleItemId, quantity } });\n  };\n\n  const updateItemDiscount = (saleItemId: string, discount: number) => {\n    dispatch({ type: 'UPDATE_DISCOUNT', payload: { saleItemId, discount } });\n  };\n\n  const completeSale = async (paymentMethod: 'cash' | 'card' | 'upi' | 'bank_transfer') => {\n    if (!state.currentSale || !user) {\n      dispatch({ type: 'COMPLETE_SALE_FAILURE', payload: 'No active sale or user' });\n      return;\n    }\n\n    if (state.currentSale.items.length === 0) {\n      dispatch({ type: 'COMPLETE_SALE_FAILURE', payload: 'Cannot complete sale with no items' });\n      return;\n    }\n\n    dispatch({ type: 'COMPLETE_SALE_START' });\n\n    try {\n      // Simulate API call\n      await new Promise(resolve => setTimeout(resolve, 1000));\n\n      const completedSale: Sale = {\n        ...state.currentSale,\n        cashierId: user.id,\n        cashier: user,\n        status: 'completed',\n        paymentMethod,\n        completedAt: new Date(),\n        updatedAt: new Date(),\n      };\n\n      // Store in localStorage for offline support\n      const existingSales = JSON.parse(localStorage.getItem('sales') || '[]');\n      existingSales.push(completedSale);\n      localStorage.setItem('sales', JSON.stringify(existingSales));\n\n      // Update product stock\n      state.currentSale.items.forEach(item => {\n        const product = item.product;\n        product.stockQuantity -= item.quantity;\n        // Update product in localStorage or send to API\n      });\n\n      dispatch({ type: 'COMPLETE_SALE_SUCCESS' });\n    } catch (error) {\n      dispatch({ type: 'COMPLETE_SALE_FAILURE', payload: 'Failed to complete sale' });\n    }\n  };\n\n  const cancelSale = () => {\n    dispatch({ type: 'CANCEL_SALE' });\n  };\n\n  const calculateTotal = (): number => {\n    return state.currentSale?.total || 0;\n  };\n\n  const scanBarcode = async (barcode: string): Promise<Product | null> => {\n    try {\n      // Simulate barcode scanning - in real app, this would call an API\n      await new Promise(resolve => setTimeout(resolve, 500));\n      \n      const product = mockProducts.find(p => p.barcode === barcode);\n      return product || null;\n    } catch (error) {\n      console.error('Barcode scan failed:', error);\n      return null;\n    }\n  };\n\n  const value: SaleContextType = {\n    currentSale: state.currentSale,\n    createSale,\n    addItemToSale,\n    removeItemFromSale,\n    updateItemQuantity,\n    updateItemDiscount,\n    completeSale,\n    cancelSale,\n    calculateTotal,\n    scanBarcode,\n  };\n\n  return (\n    <SaleContext.Provider value={value}>\n      {children}\n    </SaleContext.Provider>\n  );\n}\n\nexport function useSale(): SaleContextType {\n  const context = useContext(SaleContext);\n  if (context === undefined) {\n    throw new Error('useSale must be used within a SaleProvider');\n  }\n  return context;\n}\n\nexport { SaleContext };\n\n// Mock data for development\nconst mockProducts: Product[] = [\n  {\n    id: '1',\n    name: 'iPhone 15 Pro',\n    description: 'Latest iPhone with A17 Pro chip',\n    price: 999,\n    category: 'smartphones',\n    brand: 'Apple',\n    model: 'iPhone 15 Pro',\n    barcode: '1234567890123',\n    sku: 'APL-IP15P-128',\n    isAvailable: true,\n    stockQuantity: 25,\n    minStockLevel: 5,\n    warranty: 12,\n    specifications: {\n      'Storage': '128GB',\n      'Color': 'Natural Titanium',\n      'Display': '6.1-inch Super Retina XDR'\n    },\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  },\n  {\n    id: '2',\n    name: 'Samsung Galaxy S24',\n    description: 'Flagship Android smartphone',\n    price: 799,\n    category: 'smartphones',\n    brand: 'Samsung',\n    model: 'Galaxy S24',\n    barcode: '2345678901234',\n    sku: 'SAM-GS24-256',\n    isAvailable: true,\n    stockQuantity: 15,\n    minStockLevel: 3,\n    warranty: 12,\n    specifications: {\n      'Storage': '256GB',\n      'Color': 'Phantom Black',\n      'Display': '6.2-inch Dynamic AMOLED'\n    },\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  },\n];\n\nconst mockCustomers: Customer[] = [\n  {\n    id: '1',\n    name: 'John Doe',\n    phone: '+1234567890',\n    email: 'john@example.com',\n    address: '123 Main St, City',\n    createdAt: new Date(),\n    totalPurchases: 2500,\n    lastVisit: new Date(),\n  },\n  {\n    id: '2',\n    name: 'Jane Smith',\n    phone: '+1987654321',\n    email: 'jane@example.com',\n    createdAt: new Date(),\n    totalPurchases: 1200,\n    lastVisit: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), // 7 days ago\n  },\n];"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}